# 智能回收小程序 数据库设计文档

## 一、页面与功能分析

### 页面列表（共19个页面）

| 序号 | 页面名称 | 主要功能 |
|------|----------|----------|
| 1 | 首页 | 积分展示、核心功能入口、最近动态 |
| 2 | 智能识别 | 拍照识别垃圾分类、AI识别结果 |
| 3 | 预约回收 | 选择品类、预估重量、填写地址、上传照片 |
| 4 | 附近网点 | 地图展示、回收点列表、导航 |
| 5 | 分类指南 | 搜索物品、四大分类查询 |
| 6 | 积分商城 | 商品兑换、优惠券、公益捐赠、抽奖 |
| 7 | 预约成功 | 订单确认信息展示 |
| 8 | 我的 | 用户信息、统计数据、订单入口、设置 |
| 9-12 | 订单管理 | 待上门/进行中/已完成/售后 |
| 13 | 设置 | 个人信息、账号安全、隐私、通知 |
| 14-17 | 分类详情 | 可回收物/有害垃圾/厨余垃圾/其他垃圾详情 |
| 18 | 排行榜 | 周榜/月榜/总榜、用户排名 |
| 19 | 绿色社区 | 话题、帖子、关注、评论、活动 |

---

## 二、数据库ER图

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        智能回收小程序 数据库设计                                               │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────┐       ┌──────────────────────┐       ┌──────────────────────┐
│       user           │       │      user_address    │       │     user_level       │
├──────────────────────┤       ├──────────────────────┤       ├──────────────────────┤
│ id (PK)              │──┐    │ id (PK)              │       │ id (PK)              │
│ openid               │  │    │ user_id (FK)    ─────┼───────│ level_name           │
│ nickname             │  │    │ name                 │       │ min_points           │
│ avatar_url           │  └────│ phone                │       │ max_points           │
│ phone                │       │ province             │       │ badge_icon           │
│ total_points         │       │ city                 │       │ description          │
│ current_points       │       │ district             │       └──────────────────────┘
│ total_carbon_kg      │       │ address_detail       │
│ recycle_count        │       │ tag (家/公司)         │
│ level_id (FK)        │       │ is_default           │
│ created_at           │       │ created_at           │
│ updated_at           │       └──────────────────────┘
└──────────────────────┘
         │
         │ 1:N
         ▼
┌──────────────────────┐       ┌──────────────────────┐       ┌──────────────────────┐
│   recycle_order      │       │  order_item          │       │  recycle_category    │
├──────────────────────┤       ├──────────────────────┤       ├──────────────────────┤
│ id (PK)              │──┐    │ id (PK)              │       │ id (PK)              │
│ order_no             │  │    │ order_id (FK)   ─────┼───────│ name (纸板箱等)       │
│ user_id (FK)         │  └────│ category_id (FK)─────┼───────│ icon                 │
│ address_id (FK)      │       │ estimated_weight     │       │ points_per_kg        │
│ collector_id (FK)    │       │ actual_weight        │       │ description          │
│ status               │       │ points_earned        │       │ sort_order           │
│ appointment_date     │       └──────────────────────┘       └──────────────────────┘
│ time_slot            │
│ estimated_points     │
│ actual_points        │
│ carbon_saved_kg      │
│ photo_urls           │
│ remark               │
│ created_at           │
│ updated_at           │
│ completed_at         │
└──────────────────────┘
         │
         │ N:1
         ▼
┌──────────────────────┐       ┌──────────────────────┐       ┌──────────────────────┐
│     collector        │       │  recycle_station     │       │  station_status      │
├──────────────────────┤       ├──────────────────────┤       ├──────────────────────┤
│ id (PK)              │       │ id (PK)              │       │ id (PK)              │
│ name                 │       │ name                 │       │ name (运行中/维护中)  │
│ phone                │       │ address              │       └──────────────────────┘
│ avatar_url           │       │ latitude             │
│ rating               │       │ longitude            │
│ status               │       │ status_id (FK)       │
│ created_at           │       │ type (智能柜/服务站)  │
└──────────────────────┘       │ opening_hours        │
                               │ created_at           │
                               └──────────────────────┘

┌──────────────────────┐       ┌──────────────────────┐       ┌──────────────────────┐
│  waste_category      │       │    waste_item        │       │  recognition_log     │
├──────────────────────┤       ├──────────────────────┤       ├──────────────────────┤
│ id (PK)              │──┐    │ id (PK)              │       │ id (PK)              │
│ name (可回收物等)     │  │    │ category_id (FK)─────┼───────│ user_id (FK)         │
│ color                │  └────│ name (塑料瓶等)       │       │ image_url            │
│ icon                 │       │ icon                 │       │ result_item_id (FK)  │
│ description          │       │ disposal_tips        │       │ confidence           │
│ disposal_tips        │       │ search_keywords      │       │ is_confirmed         │
└──────────────────────┘       │ points_value         │       │ created_at           │
                               └──────────────────────┘       └──────────────────────┘

┌──────────────────────┐       ┌──────────────────────┐       ┌──────────────────────┐
│     mall_product     │       │  product_category    │       │   exchange_record    │
├──────────────────────┤       ├──────────────────────┤       ├──────────────────────┤
│ id (PK)              │       │ id (PK)              │       │ id (PK)              │
│ category_id (FK)─────┼───────│ name (生活用品等)     │       │ user_id (FK)         │
│ name                 │       │ icon                 │       │ product_id (FK)      │
│ image_url            │       │ sort_order           │       │ points_cost          │
│ points_cost          │       └──────────────────────┘       │ quantity             │
│ stock                │                                      │ status               │
│ description          │                                      │ shipping_address     │
│ is_hot               │                                      │ created_at           │
│ status               │                                      └──────────────────────┘
│ created_at           │
└──────────────────────┘

┌──────────────────────┐       ┌──────────────────────┐       ┌──────────────────────┐
│    points_record     │       │   community_post     │       │    post_comment      │
├──────────────────────┤       ├──────────────────────┤       ├──────────────────────┤
│ id (PK)              │       │ id (PK)              │       │ id (PK)              │
│ user_id (FK)         │       │ user_id (FK)         │       │ post_id (FK)         │
│ points               │       │ topic_id (FK)        │       │ user_id (FK)         │
│ type (获得/消费)      │       │ title                │       │ content              │
│ source (回收/兑换等)  │       │ content              │       │ parent_id            │
│ related_id           │       │ image_urls           │       │ like_count           │
│ description          │       │ like_count           │       │ created_at           │
│ created_at           │       │ comment_count        │       └──────────────────────┘
└──────────────────────┘       │ is_official          │
                               │ status               │
                               │ created_at           │
                               └──────────────────────┘
                                        │
                                        │ N:1
                                        ▼
┌──────────────────────┐       ┌──────────────────────┐       ┌──────────────────────┐
│   community_topic    │       │    user_follow       │       │     post_like        │
├──────────────────────┤       ├──────────────────────┤       ├──────────────────────┤
│ id (PK)              │       │ id (PK)              │       │ id (PK)              │
│ name (#变废为宝等)    │       │ user_id (FK)         │       │ post_id (FK)         │
│ icon                 │       │ follow_user_id (FK)  │       │ user_id (FK)         │
│ post_count           │       │ created_at           │       │ created_at           │
│ sort_order           │       └──────────────────────┘       └──────────────────────┘
│ is_hot               │
└──────────────────────┘

┌──────────────────────┐       ┌──────────────────────┐
│  community_activity  │       │  activity_signup     │
├──────────────────────┤       ├──────────────────────┤
│ id (PK)              │──┐    │ id (PK)              │
│ title                │  │    │ activity_id (FK)─────┼───────
│ description          │  └────│ user_id (FK)         │
│ image_url            │       │ status               │
│ activity_time        │       │ created_at           │
│ location             │       └──────────────────────┘
│ max_participants     │
│ current_participants │
│ points_reward        │
│ status               │
│ created_at           │
└──────────────────────┘

┌──────────────────────┐       ┌──────────────────────┐
│   after_sale         │       │    notification      │
├──────────────────────┤       ├──────────────────────┤
│ id (PK)              │       │ id (PK)              │
│ order_id (FK)        │       │ user_id (FK)         │
│ user_id (FK)         │       │ title                │
│ type (积分有误等)     │       │ content              │
│ description          │       │ type                 │
│ status               │       │ is_read              │
│ reply                │       │ related_id           │
│ created_at           │       │ created_at           │
│ resolved_at          │       └──────────────────────┘
└──────────────────────┘
```

---

## 三、数据库表详细设计

### 1. 用户模块

#### 1.1 user（用户表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| openid | VARCHAR(64) | 微信openid |
| nickname | VARCHAR(50) | 昵称 |
| avatar_url | VARCHAR(255) | 头像URL |
| phone | VARCHAR(20) | 手机号 |
| total_points | INT | 累计积分 |
| current_points | INT | 当前可用积分 |
| total_carbon_kg | DECIMAL(10,2) | 累计减碳量(kg) |
| recycle_count | INT | 回收次数 |
| level_id | INT | 等级ID |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 1.2 user_address（用户地址表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| user_id | BIGINT | 用户ID |
| name | VARCHAR(50) | 联系人姓名 |
| phone | VARCHAR(20) | 联系电话 |
| province | VARCHAR(50) | 省 |
| city | VARCHAR(50) | 市 |
| district | VARCHAR(50) | 区 |
| address_detail | VARCHAR(255) | 详细地址 |
| tag | VARCHAR(20) | 标签(家/公司) |
| is_default | TINYINT | 是否默认 |
| created_at | DATETIME | 创建时间 |

#### 1.3 user_level（用户等级表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INT | 主键 |
| level_name | VARCHAR(50) | 等级名称 |
| min_points | INT | 最低积分 |
| max_points | INT | 最高积分 |
| badge_icon | VARCHAR(255) | 徽章图标 |
| description | VARCHAR(255) | 等级描述 |

---

### 2. 回收订单模块

#### 2.1 recycle_order（回收订单表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| order_no | VARCHAR(32) | 订单号 |
| user_id | BIGINT | 用户ID |
| address_id | BIGINT | 地址ID |
| collector_id | BIGINT | 回收员ID |
| status | TINYINT | 状态(1待上门/2进行中/3已完成/4已取消/5售后) |
| appointment_date | DATE | 预约日期 |
| time_slot | VARCHAR(20) | 时间段 |
| estimated_points | INT | 预估积分 |
| actual_points | INT | 实际积分 |
| carbon_saved_kg | DECIMAL(10,2) | 减碳量 |
| photo_urls | TEXT | 照片URL(JSON) |
| remark | VARCHAR(255) | 备注 |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |
| completed_at | DATETIME | 完成时间 |

#### 2.2 order_item（订单明细表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| order_id | BIGINT | 订单ID |
| category_id | INT | 品类ID |
| estimated_weight | VARCHAR(20) | 预估重量 |
| actual_weight | DECIMAL(10,2) | 实际重量 |
| points_earned | INT | 获得积分 |

#### 2.3 recycle_category（回收品类表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INT | 主键 |
| name | VARCHAR(50) | 品类名称 |
| icon | VARCHAR(100) | 图标 |
| points_per_kg | INT | 每公斤积分 |
| description | VARCHAR(255) | 描述 |
| sort_order | INT | 排序 |

#### 2.4 collector（回收员表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| name | VARCHAR(50) | 姓名 |
| phone | VARCHAR(20) | 电话 |
| avatar_url | VARCHAR(255) | 头像 |
| rating | DECIMAL(2,1) | 评分 |
| status | TINYINT | 状态 |
| created_at | DATETIME | 创建时间 |

---

### 3. 网点模块

#### 3.1 recycle_station（回收网点表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| name | VARCHAR(100) | 网点名称 |
| address | VARCHAR(255) | 地址 |
| latitude | DECIMAL(10,6) | 纬度 |
| longitude | DECIMAL(10,6) | 经度 |
| status_id | INT | 状态ID |
| type | VARCHAR(20) | 类型(智能柜/服务站) |
| opening_hours | VARCHAR(50) | 营业时间 |
| created_at | DATETIME | 创建时间 |

#### 3.2 station_status（网点状态表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INT | 主键 |
| name | VARCHAR(20) | 状态名称 |

---

### 4. 垃圾分类模块

#### 4.1 waste_category（垃圾分类表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INT | 主键 |
| name | VARCHAR(50) | 分类名称 |
| color | VARCHAR(20) | 颜色 |
| icon | VARCHAR(100) | 图标 |
| description | VARCHAR(255) | 描述 |
| disposal_tips | TEXT | 投放要求 |

#### 4.2 waste_item（垃圾物品表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| category_id | INT | 分类ID |
| name | VARCHAR(50) | 物品名称 |
| icon | VARCHAR(100) | 图标 |
| disposal_tips | VARCHAR(255) | 处理提示 |
| search_keywords | VARCHAR(255) | 搜索关键词 |
| points_value | INT | 积分价值 |

#### 4.3 recognition_log（识别记录表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| user_id | BIGINT | 用户ID |
| image_url | VARCHAR(255) | 图片URL |
| result_item_id | BIGINT | 识别结果物品ID |
| confidence | DECIMAL(5,2) | 置信度 |
| is_confirmed | TINYINT | 用户是否确认 |
| created_at | DATETIME | 创建时间 |

---

### 5. 积分商城模块

#### 5.1 mall_product（商城商品表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| category_id | INT | 分类ID |
| name | VARCHAR(100) | 商品名称 |
| image_url | VARCHAR(255) | 图片URL |
| points_cost | INT | 所需积分 |
| stock | INT | 库存 |
| description | TEXT | 描述 |
| is_hot | TINYINT | 是否热门 |
| status | TINYINT | 状态 |
| created_at | DATETIME | 创建时间 |

#### 5.2 product_category（商品分类表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INT | 主键 |
| name | VARCHAR(50) | 分类名称 |
| icon | VARCHAR(100) | 图标 |
| sort_order | INT | 排序 |

#### 5.3 exchange_record（兑换记录表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| user_id | BIGINT | 用户ID |
| product_id | BIGINT | 商品ID |
| points_cost | INT | 消耗积分 |
| quantity | INT | 数量 |
| status | TINYINT | 状态 |
| shipping_address | VARCHAR(255) | 收货地址 |
| created_at | DATETIME | 创建时间 |

#### 5.4 points_record（积分记录表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| user_id | BIGINT | 用户ID |
| points | INT | 积分变动 |
| type | TINYINT | 类型(1获得/2消费) |
| source | VARCHAR(50) | 来源(回收/兑换/邀请等) |
| related_id | BIGINT | 关联ID |
| description | VARCHAR(255) | 描述 |
| created_at | DATETIME | 创建时间 |

---

### 6. 社区模块

#### 6.1 community_topic（话题表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INT | 主键 |
| name | VARCHAR(50) | 话题名称 |
| icon | VARCHAR(100) | 图标 |
| post_count | INT | 帖子数 |
| sort_order | INT | 排序 |
| is_hot | TINYINT | 是否热门 |

#### 6.2 community_post（帖子表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| user_id | BIGINT | 用户ID |
| topic_id | INT | 话题ID |
| title | VARCHAR(100) | 标题 |
| content | TEXT | 内容 |
| image_urls | TEXT | 图片URL(JSON) |
| like_count | INT | 点赞数 |
| comment_count | INT | 评论数 |
| is_official | TINYINT | 是否官方 |
| status | TINYINT | 状态 |
| created_at | DATETIME | 创建时间 |

#### 6.3 post_comment（评论表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| post_id | BIGINT | 帖子ID |
| user_id | BIGINT | 用户ID |
| content | TEXT | 内容 |
| parent_id | BIGINT | 父评论ID |
| like_count | INT | 点赞数 |
| created_at | DATETIME | 创建时间 |

#### 6.4 post_like（点赞表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| post_id | BIGINT | 帖子ID |
| user_id | BIGINT | 用户ID |
| created_at | DATETIME | 创建时间 |

#### 6.5 user_follow（关注表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| user_id | BIGINT | 用户ID |
| follow_user_id | BIGINT | 被关注用户ID |
| created_at | DATETIME | 创建时间 |

#### 6.6 community_activity（社区活动表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| title | VARCHAR(100) | 活动标题 |
| description | TEXT | 活动描述 |
| image_url | VARCHAR(255) | 封面图 |
| activity_time | DATETIME | 活动时间 |
| location | VARCHAR(255) | 活动地点 |
| max_participants | INT | 最大参与人数 |
| current_participants | INT | 当前参与人数 |
| points_reward | INT | 积分奖励 |
| status | TINYINT | 状态 |
| created_at | DATETIME | 创建时间 |

#### 6.7 activity_signup（活动报名表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| activity_id | BIGINT | 活动ID |
| user_id | BIGINT | 用户ID |
| status | TINYINT | 状态 |
| created_at | DATETIME | 创建时间 |

---

### 7. 其他模块

#### 7.1 after_sale（售后表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| order_id | BIGINT | 订单ID |
| user_id | BIGINT | 用户ID |
| type | VARCHAR(50) | 问题类型 |
| description | TEXT | 问题描述 |
| status | TINYINT | 状态 |
| reply | TEXT | 客服回复 |
| created_at | DATETIME | 创建时间 |
| resolved_at | DATETIME | 解决时间 |

#### 7.2 notification（通知表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 主键 |
| user_id | BIGINT | 用户ID |
| title | VARCHAR(100) | 标题 |
| content | TEXT | 内容 |
| type | VARCHAR(50) | 类型 |
| is_read | TINYINT | 是否已读 |
| related_id | BIGINT | 关联ID |
| created_at | DATETIME | 创建时间 |

---

## 四、数据库表汇总

| 模块 | 表名 | 说明 |
|------|------|------|
| 用户模块 | user | 用户基本信息 |
| 用户模块 | user_address | 用户地址 |
| 用户模块 | user_level | 用户等级 |
| 订单模块 | recycle_order | 回收订单 |
| 订单模块 | order_item | 订单明细 |
| 订单模块 | recycle_category | 回收品类 |
| 订单模块 | collector | 回收员 |
| 网点模块 | recycle_station | 回收网点 |
| 网点模块 | station_status | 网点状态 |
| 分类模块 | waste_category | 垃圾分类 |
| 分类模块 | waste_item | 垃圾物品 |
| 分类模块 | recognition_log | 识别记录 |
| 商城模块 | mall_product | 商城商品 |
| 商城模块 | product_category | 商品分类 |
| 商城模块 | exchange_record | 兑换记录 |
| 商城模块 | points_record | 积分记录 |
| 社区模块 | community_topic | 话题 |
| 社区模块 | community_post | 帖子 |
| 社区模块 | post_comment | 评论 |
| 社区模块 | post_like | 点赞 |
| 社区模块 | user_follow | 关注 |
| 社区模块 | community_activity | 社区活动 |
| 社区模块 | activity_signup | 活动报名 |
| 其他模块 | after_sale | 售后 |
| 其他模块 | notification | 通知 |

**共计 25 张数据库表**
