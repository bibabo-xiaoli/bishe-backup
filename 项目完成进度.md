# 项目完成进度

> 后端采用 Python + Flask 构建 RESTful API 服务，数据库使用 MySQL 8.0，前端管理系统基于 `ui/` 目录下的静态页面。

## 一、环境与基础结构

- [x] 在项目根目录创建虚拟环境 `venv/`
- [x] 在虚拟环境中安装依赖：`flask`、`pymysql`
- [x] 新建后端目录 `admin/`，主要文件：
  - `admin/config.py`：Flask & MySQL 配置（默认数据库：`bishe`，密码：`114856`）
  - `admin/db.py`：封装 MySQL 连接（使用 PyMySQL + Flask `g`）
  - `admin/app.py`：Flask 应用入口与路由
  - `admin/schema.sql`：MySQL 8.0 建表脚本（核心业务表）

## 二、数据库（MySQL 8.0）

- [x] 依据 `ui/数据库表.md` 设计，初步落地以下核心表：
  - `user`：用户基础信息，含积分、减碳量、等级、回收次数等
  - `user_address`：用户地址，含默认地址标记
  - `user_level`：用户等级及积分区间
  - `recycle_category`：回收类别、图标、积分权重等
  - `collector`：回收员信息
  - `recycle_order`：回收订单（预约时间、状态、积分、减碳量等）
  - `order_item`：订单明细（各类别重量与积分）
  - `points_record`：积分记录（获得/消费）
- [ ] 其余表（积分商城、社区模块等）根据 `ui/数据库表.md` 后续逐步补充进 `schema.sql`
- [ ] 在本机 MySQL 中执行 `admin/schema.sql` 完成建库建表（需在命令行中手动执行）：

```sql
mysql -u root -p < admin/schema.sql
```

> 说明：当前脚本已默认创建 `bishe` 数据库并 `USE bishe;`。

## 三、后端 RESTful API（Flask）

当前已实现的接口（详见 `api接口文档.md`）：

- [x] `GET /api/health`
  - 用于健康检查，前端或调试时快速确认后端可用。
- [x] `GET /api/users`
  - 支持分页、搜索（昵称/手机号/ID）、等级筛选，供 `admin-users.html` 用户列表使用。
- [x] `GET /api/users/<id>`
  - 返回单个用户详情，含等级信息与默认地址信息，预留给用户详情弹窗。
- [x] `GET /api/dashboard/summary`
  - 仪表盘汇总数据：用户总数、今日新增、活跃用户数、今日订单数、今日减碳量、积分发放（总计 & 今日）。

计划中的接口：

- [ ] 订单列表及详情接口：`/api/orders`, `/api/orders/<id>` 等（对接 `admin-orders.html`）
- [ ] 排行榜/统计类接口：积分榜、减碳榜等
- [ ] 小程序端相关接口：预约回收、附近网点、积分商城、社区等

## 四、前端管理系统联通情况（UI ↔ API ↔ DB）

### 1. `ui/admin-users.html` 用户管理页

- [x] 保留原有 UI 样式不变，只新增元素 ID 与脚本：
  - 统计卡片数值增加 ID：
    - 总用户数：`id="user-total"`
    - 今日新增：`id="user-today-new"`
    - 活跃用户：`id="user-active-count"`
    - 已禁用：`id="user-disabled-count"`
  - 筛选区增加 ID：
    - 搜索框：`id="user-search-input"`
    - 等级筛选：`id="user-level-select"`
    - 查询按钮：`id="user-search-button"`
    - 重置按钮：`id="user-reset-button"`
  - 表格主体：`<tbody id="user-table-body">`，由 JS 动态填充
  - 分页统计文案：`<span id="user-total-count">共 12,580 条记录</span>`，由 JS 动态更新
- [x] 新增页面内脚本：
  - `API_BASE = 'http://127.0.0.1:5000'`
  - `loadUserStats()`：调用 `/api/dashboard/summary` 更新四个用户统计卡片
  - `loadUsers(page = 1, perPage = 10)`：调用 `/api/users`，根据筛选条件渲染用户表格
  - 在 `DOMContentLoaded` 事件中自动调用上述函数，并绑定“查询 / 重置”按钮事件

> 结果：在本地启动 Flask 后端，并有数据写入 MySQL 后，刷新 `ui/admin-users.html` 即可看到来自数据库的用户列表与统计数据。

### 2. `ui/admin.html` 仪表盘首页

- [x] 为四个统计卡片的数字增加 ID：
  - 注册用户：`id="dashboard-total-users"`
  - 今日订单：`id="dashboard-today-orders"`
  - 今日减碳量：`id="dashboard-today-carbon"`
  - 积分发放：`id="dashboard-total-points"`
- [x] 在页面底部新增脚本：
  - `loadDashboardSummary()` 调用 `/api/dashboard/summary`，填充上述四个指标
  - 在 `DOMContentLoaded` 事件中自动执行

> 结果：保持原有仪表盘视觉不变，只是数字由后台实时数据驱动。

### 3. 其他管理页面

- [ ] `ui/admin-orders.html`：尚未与 `/api/orders` 等接口联通，当前仍为静态示例数据
- [ ] 其他页面（网点管理、积分商城、社区等）：尚未与后端联通

## 五、下一步建议

1. **在本机 MySQL 执行 `admin/schema.sql`，插入少量测试数据**，验证当前 API 与页面联调是否正常。
2. **补全 `schema.sql` 中剩余的表**（积分商城、社区模块等），与 `ui/数据库表.md` 保持一致。
3. **实现订单相关接口并联通 `admin-orders.html`**，包括状态统计、列表筛选与详情查看。
4. 根据需要扩展小程序端接口（预约、网点、积分商城、社区）并编写对应前端调用逻辑。

